---
---
title: "Analisis Regresi 3"
author: "M. Haikal Tabrani | M0401241060"
date: "`r Sys.Date()`"
output:
rmdformats::downcute:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: tango
---

---

Read Dataset
```{r}
library(readxl)
dt<-read_excel("C:\\Users\\a c e r\\OneDrive\\SEMESTER 4\\ANALISIS REGRESI\\DATA ANREG PRAK\\DATASET-XLSX-M0401241060.xlsx")
dt
```

Menentukan variabel X dan Y. Operating Profit Margin (OPM) sebagai variabel X dan Net Profit Margin (NPM) sebagai variabel Y.
```{r}
x<-dt$OPM_X2
y<-dt$NPM_Y
n <- length(dt)
```

Menyederhanakan dataframe menjadi tabel dengan kolom variabel X dan Y.
```{r}
dt<-data.frame(cbind(y,x))
dt
```

Membangkitkan hasil model regresi linear sederhana.
```{r}
model <- lm(y~x, dt)
summary(model)
```
Didapatkan nilai dari Intercept sebesar 0.046432 dan nilai dari koefisien regresi sebesar 0.494616. Berdasarkan dua hasil yang didapat, persamaan regresi sebagai berikut:
$$E[\hat{Y}] = \hat{Y} = 0,046432 + 0,494616 X$$

Supaya dapat lebih mudah dipahami, saya visualisasikan hubungan antar variabel X dan Y melalui grafik Scatter Plot berikut.
```{r}
y.bar <- mean(y)
plot(x,y)
abline(model, col="red")
text(30, 220, "Y_duga", adj = c(-0.1, 1.5), col = "red", cex = 0.8)
abline(h=y.bar, col="blue")
text(31, 185, "Y_bar", adj = c(-0.1, 1.5), col = "blue", cex = 0.8)
```

Dari scatter plot di atas, teramati adanya amatan yang menyimpang relatif terhadap nilai harapannya. Penyimpangan amatan dari nilai harapannya inilah yang disebut sebagai galat. Keragaman dari galat tiap amatan ini dapat diurai berdasarkan garis dugaan persamaan ($\hat{Y}$) dan garis rataan nilai resposnya ($\bar{Y}$). Penguraian keragaman ini dapat dituliskan sebagai Jumlah Kuadrat Regresi (JKR), Jumlah Kuadrat Galat (JKG), dan Jumlah Kuadrat Total (JKT) dengan perhitungan sebagai berikut.
$$\text{JKR} = \sum_{i=1}^{n} (\hat{y}_i - \bar{y})^2 ; \text{JKG} = \sum_{i=1}^{n} (y_i - \hat{y})^2 ; \text{JKT} = \sum_{i=1}^{n} (y_i - \bar{y})^2$$
Hubungan antara ketiganya adalah sebagai berikut. 

$$JKT = JKR + JKG$$
Nilai penguraian keragaman ini dapat diamati pula menggunakan fungsi anova pada bagian **Sum Sq (Jumlah Kuadrat)** seperti yang ditampilkan di bawah. Pada output sintaks di bawah, JKR model bernilai 0.92086, JKG model bernilai 1.34445, dan JKR Total bernilai 2.26531.

```{r}
(anova.model <- anova(model))
```
$$\sigma^2_e = S_{e}^2=  \text{KTG} = \frac{\text{JKG}}{n-2}$$

```{r}
(KTG <- anova.model$`Mean Sq`[2])
```

Dari nilai dugaan ragam galat di atas, dapat diduga pula nilai dugaan dari simpangan bakunya. Dugaan simpangan baku inilah yang disebut sebagai galat baku. Hubungan antara galat baku dan ragam galat dapat dituliskan sebagai berikut.

$$S_e = \sqrt{S_{e}^2}$$
Oleh karena simpangan baku merupakan akar kuadrat dari ragam, maka nilai dugaan galat baku model yang kita bentuk adalah 
$S_e = \sqrt{0.008002695} \approx 0.089462$
```{r}
(galat.baku <- sqrt(KTG))
```
Sebelumnya, melalui fungsi `lm` dan perhitungan manual yang sudah dibahas pada pertemuan sebelumnya, kita sudah mendapatkan nilai dugaan parameter β0 dan β1 sebesar 0,046432 dan 0,494616. Kedua nilai dugaan parameter tersebut dapat kita definisikan sebagai berikut.

```{r}
(b0 <- model$coefficients[[1]])

```
```{r}
(b1 <- model$coefficients[[2]])
```

Selanjutnya kita dapat menghitung nilai ragam dan t-hitung dari dugaan parameter $β_0$ tersebut dengan perhitungan sebagai berikut.

$$\text{S}_{\hat{\beta_0}} = \sqrt{KTG \left[\frac{1}{n} + \frac{\bar{X}^2}{\sum_{i=1}^{n}(X_i - \bar{X})^2}\right]} ; t_{h} = \frac{\hat{\beta_0} - \beta_0}{S_{\hat{\beta_0}}}$$

```{r}
(se_b0 <- sqrt(KTG*(1/n+mean(x)^2/sum((x-mean(x))^2))))
```
Nilai T Hitung untuk intersep.
```{r}
uji <- 0
(t_b0 <- (b0 - uji)/se_b0)
```
Nilai T Tabel
```{r}
abs(qt(0.025, df = n-2))
```
$$\text{S}_{\hat{\beta_1}} = \sqrt{\frac{KTG}{\sum_{i=1}^{n}(x_i - \bar{x})^2}} ; t_{h} = \frac{\hat{\beta_1} - \beta_1}{S_{\hat{\beta_1}}}$$
```{r}
(se_b1 <- sqrt(KTG/sum((x-mean(x))^2)))
```
Nilai T Hitung Koefisien Regresi.
```{r}
uji <- 0
(t_b1 <- (b1 - uji)/se_b1)
```
```{r}
abs(qt(0.025, df = n-2))
```
Secara umum, kita dapat memahami bahwa selang kepercayaan untuk $β_0$ dan $β_1$ terdiri atas batas bawah dan batas atas yang dapat dituliskan sebagai berikut.

$$\text{Selang Kepercayaan } \beta_0 : \hat{\beta_0} \pm t_{\alpha/2, n-2} S_{\hat{\beta_0}}$$
$$\text{Selang Kepercayaan } \beta_1 : \hat{\beta_1} \pm t_{\alpha/2, n-2} S_{\hat{\beta_1}}$$
```{r}
t_table <- abs(qt(0.025, df = n-2))
t_table
```
```{r}
lower_b0 <- b0 - t_table * se_b0
upper_b0 <- b0 + t_table * se_b0
cat("Selang kepercayaan beta0: [", lower_b0, ", ", upper_b0, "]\n")
```

```{r}
lower_b1 <- b1 - t_table * se_b1
upper_b1 <- b1 + t_table * se_b1
cat("Selang kepercayaan beta1: [", lower_b1, ", ", upper_b1, "]\n")
```
Sehigga dapat disimpulkan bahwa pada taraf signifikansi 5%, selang kepercayaan untuk parameter $β_0$ adalah [48.14893 ,  52.55772] dan untuk parameter $β_1$ adalah [-0.0007437866 ,  0.09360689]

```{r}
amatan.diduga <- data.frame(x=10)
predict(model, amatan.diduga, interval = "confidence")
```


Misalkan kita ingin menduga nilai individu amatan ketika nilai x=10. Kita dapat memanfaatkan fungsi `predict` untuk mendapatkan nilai dugaan dan selang kepercayaannya sebagai berikut.

```{r}
predict(model, amatan.diduga, interval = "prediction")
```